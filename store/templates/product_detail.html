{% extends 'base.html' %}
{% block title %}{{ product.title }}{% endblock %}

{% block content %}
<div class="md:flex gap-10">

  <!-- üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
  <div class="md:w-1/2">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.title }}" class="w-full h-auto rounded-lg shadow-lg">
    {% else %}
      <img src="https://via.placeholder.com/500x400?text=No+Image" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="w-full h-auto rounded-lg shadow-lg">
    {% endif %}
  </div>

  <!-- üõí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
  <div class="md:w-1/2">
    <div class="flex items-center justify-between mb-2">
      <h1 class="text-3xl font-bold text-primary">{{ product.title }}</h1>

      <!-- ‚≠ê –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ -->
      <div class="flex items-center gap-1">
        {% if avg_rating %}
          {% for i in "12345" %}
            {% if forloop.counter <= avg_rating %}
              <span class="text-yellow-400 text-xl">‚òÖ</span>
            {% else %}
              <span class="text-gray-600 text-xl">‚òÖ</span>
            {% endif %}
          {% endfor %}
          <span class="text-gray-400 text-sm ml-1">({{ avg_rating|floatformat:1 }} / 5)</span>
        {% else %}
          <span class="text-gray-400 text-sm">(–Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫)</span>
        {% endif %}
      </div>
    </div>

    <p class="text-gray-400 mb-4">{{ product.description }}</p>

    {% if product.active_sale %}
      <div class="text-lg text-gray-400 line-through">‚Ç∏{{ product.price|floatformat:0 }}</div>
      <div class="text-3xl font-bold text-red-500 mb-2">
        ‚Ç∏{{ product.discounted_price|floatformat:0 }}
      </div>
      <p class="text-sm text-green-400 mb-6">–°–∫–∏–¥–∫–∞ {{ product.active_sale.discount_percent }}%</p>
    {% else %}
      <p class="text-primary text-2xl font-bold mb-6">‚Ç∏{{ product.price|floatformat:0 }}</p>
    {% endif %}

    <form action="{% url 'store:add_to_cart' product.id %}" method="post" class="flex items-center gap-3">
      {% csrf_token %}
      <input type="number" name="quantity" value="1" min="1" class="w-20 p-2 rounded bg-secondary text-gray-200">
      <button type="submit" class="bg-primary text-white px-6 py-3 rounded-xl hover:bg-teal-500 transition">
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
      </button>
    </form>
  </div>
</div>

<!-- üó®Ô∏è –û–¢–ó–´–í–´ -->
<div class="mt-12 border-t border-gray-700 pt-8">
  <h2 class="text-2xl font-semibold text-primary mb-6">–û—Ç–∑—ã–≤—ã</h2>

  {% if user.is_authenticated %}
    <form action="{% url 'store:add_review' product.id %}" method="post" class="space-y-4 mb-10">
      {% csrf_token %}
      <div>
        <label class="block text-gray-300 mb-2 font-medium">–û—Ü–µ–Ω–∫–∞:</label>
        <div class="flex flex-row-reverse justify-end gap-1">
          {% for i in "54321" %}
            <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" class="hidden peer" />
            <label for="star{{ i }}" 
                   class="text-3xl cursor-pointer text-gray-500 peer-checked:text-yellow-400 hover:text-yellow-400 transition">
              ‚òÖ
            </label>
          {% endfor %}
        </div>
      </div>

      <div>
        <label class="block text-gray-300 mb-1">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        {{ form.text }}
      </div>

      <button type="submit"
              class="bg-primary hover:bg-teal-500 text-white font-semibold px-6 py-2 rounded-xl">
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
      </button>
    </form>
  {% else %}
    <p class="text-gray-400 mb-4">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤.</p>
  {% endif %}

  <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ -->
  {% if product.reviews.exists %}
    {% for review in product.reviews.all %}
      <div class="bg-accent/70 p-4 rounded-xl mb-3">
        <div class="flex justify-between items-center mb-2">
          <span class="font-semibold text-primary">{{ review.user.username }}</span>

          <!-- ‚≠ê –ó–≤—ë–∑–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∑—ã–≤–∞ -->
          <div class="flex items-center gap-1">
            {% for i in "12345" %}
              {% if forloop.counter <= review.rating %}
                <span class="text-yellow-400 text-xl">‚òÖ</span>
              {% else %}
                <span class="text-gray-600 text-xl">‚òÖ</span>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        <p class="text-gray-300">{{ review.text }}</p>
        <p class="text-sm text-gray-500 mt-1">{{ review.created_at|date:"d.m.Y H:i" }}</p>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</p>
  {% endif %}
</div>

<style>
  input[type="radio"] ~ label:hover,
  input[type="radio"] ~ label:hover ~ label {
    color: #facc15 !important;
  }
</style>

{% endblock %}
